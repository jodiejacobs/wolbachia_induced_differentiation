2025-03-13 13:53:10,874 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 13:53:10,874 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 13:53:10,875 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/fca_adata.h5ad
2025-03-13 13:53:10,875 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/fca_atlas_v0
2025-03-13 13:53:10,875 - INFO - Loading data files...
2025-03-13 13:53:11,055 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 13:55:31,180 - INFO - Reference dataset loaded: (62515, 2431) (cells × genes)
2025-03-13 13:55:31,185 - INFO - Number of shared genes: 1234
2025-03-13 13:55:31,185 - INFO - Preprocessing datasets...
2025-03-13 13:57:02,806 - INFO - Using 1234 shared genes
2025-03-13 13:57:43,409 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 13:57:43,414 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 13:57:43,414 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/fca_adata.h5ad
2025-03-13 13:57:43,414 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/fca_atlas_v0
2025-03-13 13:57:43,414 - INFO - Loading data files...
2025-03-13 13:57:43,621 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 14:00:01,034 - INFO - Reference dataset loaded: (62515, 2431) (cells × genes)
2025-03-13 14:00:01,041 - INFO - Number of shared genes: 1234
2025-03-13 14:00:01,042 - INFO - Preprocessing datasets...
2025-03-13 14:01:28,564 - INFO - Using 1234 shared genes
2025-03-13 14:28:24,807 - INFO - Integrating datasets...
2025-03-13 14:28:25,468 - INFO - Combined dataset shape: (6688, 1234)
2025-03-13 14:28:25,468 - INFO - Data is already normalized and log-transformed
2025-03-13 14:28:25,561 - INFO - Applying BBKNN batch correction...
2025-03-13 14:29:30,143 - INFO - Automatically determined k = 5 (sqrt(n) = 81, 10% of smallest class = 0)
2025-03-13 14:29:30,166 - INFO - Performing kNN classification with k=5...
2025-03-13 14:29:30,170 - INFO - Sample values from 'annotation': ['spermatocyte', 'unannotated', 'cyst cell intermediate', 'cyst cell intermediate', 'spermatocyte cyst cell branch b']
2025-03-13 14:29:30,221 - INFO - Successfully extracted 6664 reference labels
2025-03-13 14:29:30,221 - INFO - Reference cells: 6664, Bulk samples: 24
2025-03-13 14:29:30,221 - INFO - Using UMAP embeddings for kNN search
2025-03-13 14:29:30,222 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 14:29:30,709 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 14:29:31,081 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 14:29:31,473 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 14:29:31,843 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 14:29:32,238 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 14:29:32,608 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 14:29:32,984 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 14:29:33,357 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 14:29:33,783 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 14:29:34,181 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 14:29:34,588 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 14:29:35,041 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 14:29:35,435 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 14:29:35,832 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 14:29:36,258 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 14:29:36,651 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 14:29:37,078 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 14:29:37,473 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 14:29:37,869 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 14:29:38,266 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 14:29:38,659 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 14:29:39,060 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 14:29:39,455 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 14:29:39,878 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 14:29:39,878 - INFO - Classification summary:
2025-03-13 14:29:39,880 - INFO -   artefact: 10 bulk samples (mean confidence: 0.6624)
2025-03-13 14:29:39,881 - INFO -   adult Malpighian tubule principal cell: 4 bulk samples (mean confidence: 0.5898)
2025-03-13 14:29:39,882 - INFO -   female reproductive system: 4 bulk samples (mean confidence: 0.4017)
2025-03-13 14:29:39,883 - INFO -   adult Malpighian tubule principal cell of lower segment: 2 bulk samples (mean confidence: 0.7936)
2025-03-13 14:29:39,883 - INFO -   ejaculatory bulb: 2 bulk samples (mean confidence: 0.8014)
2025-03-13 14:29:39,884 - INFO -   unannotated: 2 bulk samples (mean confidence: 0.5995)
2025-03-13 14:29:39,884 - INFO - P-value summary:
2025-03-13 14:29:39,885 - INFO -   Mean p-value: 0.4271
2025-03-13 14:29:39,885 - INFO -   Median p-value: 0.3835
2025-03-13 14:29:39,885 - INFO -   Min p-value: 0.0870
2025-03-13 14:29:39,886 - INFO -   Max p-value: 1.0000
2025-03-13 14:29:39,886 - INFO - Generating UMAP visualizations...
2025-03-13 14:30:37,417 - INFO - UMAP visualizations completed
2025-03-13 14:30:37,931 - INFO - Integration pipeline completed successfully
2025-03-13 14:30:37,932 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/fca_atlas_v0
2025-03-13 14:30:37,932 - INFO - Plotting UMAP...
