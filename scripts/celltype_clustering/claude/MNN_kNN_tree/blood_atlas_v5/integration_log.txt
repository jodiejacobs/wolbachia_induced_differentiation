2025-03-17 15:18:07,192 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-17 15:18:07,192 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-17 15:18:07,192 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-17 15:18:07,193 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v5
2025-03-17 15:18:07,193 - INFO - Loading data files...
2025-03-17 15:18:07,419 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-17 15:18:09,064 - INFO - Reference dataset loaded: (14399, 2000) (cells × genes)
2025-03-17 15:18:09,068 - INFO - Number of shared genes: 1024
2025-03-17 15:18:09,068 - INFO - Preprocessing datasets...
2025-03-17 15:18:10,745 - INFO - Using 1024 shared genes
2025-03-17 15:18:13,736 - INFO - Integrating datasets...
2025-03-17 15:18:13,766 - INFO - Combined dataset shape: (1094, 1024)
2025-03-17 15:18:13,766 - INFO - Data is already normalized and log-transformed
2025-03-17 15:18:13,789 - INFO - Applying BBKNN batch correction...
2025-03-17 15:18:17,982 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-17 15:18:17,982 - INFO - Performing kNN classification with k=21...
2025-03-17 15:18:17,983 - INFO - Sample values from 'subclustering': ['PH', 'PH', 'PH', 'PH', 'PH']
2025-03-17 15:18:17,989 - INFO - Successfully extracted 1070 reference labels
2025-03-17 15:18:17,989 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-17 15:18:17,990 - INFO - Using UMAP embeddings for kNN search
2025-03-17 15:18:17,990 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-17 15:18:18,415 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-17 15:18:18,823 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-17 15:18:19,237 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-17 15:18:19,641 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-17 15:18:20,048 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-17 15:18:20,507 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-17 15:18:20,910 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-17 15:18:21,315 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-17 15:18:21,719 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-17 15:18:22,157 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-17 15:18:22,567 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-17 15:18:22,976 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-17 15:18:23,378 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-17 15:18:23,780 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-17 15:18:24,157 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-17 15:18:24,562 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-17 15:18:24,937 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-17 15:18:25,310 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-17 15:18:25,716 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-17 15:18:26,122 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-17 15:18:26,528 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-17 15:18:26,899 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-17 15:18:27,276 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-17 15:18:27,683 - INFO - kNN classification completed for all 24 bulk samples
2025-03-17 15:18:27,683 - INFO - Classification summary:
2025-03-17 15:18:27,685 - INFO -   LM: 12 bulk samples (mean confidence: 0.7944)
2025-03-17 15:18:27,686 - INFO -   PM: 12 bulk samples (mean confidence: 0.5840)
2025-03-17 15:18:27,686 - INFO - P-value summary:
2025-03-17 15:18:27,686 - INFO -   Mean p-value: 0.3596
2025-03-17 15:18:27,687 - INFO -   Median p-value: 0.3795
2025-03-17 15:18:27,687 - INFO -   Min p-value: 0.0960
2025-03-17 15:18:27,687 - INFO -   Max p-value: 0.6480
2025-03-17 15:18:27,688 - INFO - Generating UMAP visualizations...
2025-03-17 15:18:50,459 - INFO - UMAP visualizations completed
2025-03-17 15:18:51,170 - INFO - Integration pipeline completed successfully
2025-03-17 15:18:51,171 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v5
2025-03-17 15:18:51,171 - INFO - Plotting UMAP...
