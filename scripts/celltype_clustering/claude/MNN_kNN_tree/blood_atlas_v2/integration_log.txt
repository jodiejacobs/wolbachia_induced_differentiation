2025-03-13 11:43:58,882 - INFO - Memory limit set to: 2024.0 GB
2025-03-13 11:43:58,883 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 11:43:58,883 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 11:43:58,883 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 11:43:58,883 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v2
2025-03-13 11:43:58,883 - INFO - Loading data files...
2025-03-13 11:43:59,605 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 11:44:01,053 - INFO - Reference dataset loaded in backed mode: (14399, 2000) (cells × genes)
2025-03-13 11:44:01,117 - INFO - Number of shared genes: 1024
2025-03-13 11:44:01,117 - INFO - Reloading reference data with only shared genes...
2025-03-13 11:44:09,443 - INFO - Reference dataset loaded with shared genes only: (14399, 1024)
2025-03-13 11:44:09,593 - INFO - Preprocessing datasets...
2025-03-13 11:44:09,776 - ERROR - Annotation key 'cell_type' not found in reference data.
2025-03-13 11:44:09,776 - ERROR - Available keys: ['orig.ident', 'nCount_RNA', 'nFeature_RNA', 'dataset', 'Library', 'percent.mt', 'celltype', 'subclustering', 'origin', 'condition', 'celltype_condition', 'celltype_condition_timepoint', 'n_genes', 'leiden']
2025-03-13 11:44:38,568 - INFO - Memory limit set to: 4096.0 GB
2025-03-13 11:44:38,575 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 11:44:38,575 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 11:44:38,575 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 11:44:38,575 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v2
2025-03-13 11:44:38,575 - INFO - Loading data files...
2025-03-13 11:44:38,709 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 11:44:39,186 - INFO - Reference dataset loaded in backed mode: (14399, 2000) (cells × genes)
2025-03-13 11:44:39,191 - INFO - Number of shared genes: 1024
2025-03-13 11:44:39,192 - INFO - Reloading reference data with only shared genes...
2025-03-13 11:44:40,465 - INFO - Reference dataset loaded with shared genes only: (14399, 1024)
2025-03-13 11:44:40,584 - INFO - Preprocessing datasets...
2025-03-13 11:44:41,839 - INFO - Concatenating 5 subsampled datasets
2025-03-13 11:44:41,969 - INFO - Integrating datasets...
2025-03-13 11:44:41,969 - INFO - Concatenating datasets...
2025-03-13 11:44:41,978 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 11:44:42,071 - INFO - Data is already normalized and log-transformed
2025-03-13 11:44:42,071 - INFO - Checking for and handling NaN values...
2025-03-13 11:44:42,077 - INFO - Applying BBKNN batch correction...
2025-03-13 11:44:42,077 - INFO - Computing PCA...
2025-03-13 11:44:44,863 - INFO - Running BBKNN...
2025-03-13 11:44:46,964 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 11:44:46,964 - INFO - Performing kNN classification with k=21...
2025-03-13 11:44:46,965 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:02:04,994 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 12:02:05,006 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 12:02:05,006 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 12:02:05,006 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v2
2025-03-13 12:02:05,006 - INFO - Loading data files...
2025-03-13 12:02:05,143 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 12:02:06,179 - INFO - Reference dataset loaded: (14399, 2000) (cells × genes)
2025-03-13 12:02:06,182 - INFO - Number of shared genes: 1024
2025-03-13 12:02:06,183 - INFO - Preprocessing datasets...
2025-03-13 12:02:06,893 - INFO - Using 1024 shared genes
2025-03-13 12:02:09,889 - INFO - Integrating datasets...
2025-03-13 12:02:09,918 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 12:02:09,919 - INFO - Data is already normalized and log-transformed
2025-03-13 12:02:09,940 - INFO - Applying BBKNN batch correction...
2025-03-13 12:02:14,105 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 12:02:14,106 - INFO - Performing kNN classification with k=21...
2025-03-13 12:02:14,106 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:02:15,003 - INFO - kNN classification completed
2025-03-13 12:02:15,004 - INFO - Generating UMAP visualizations...
2025-03-13 12:02:29,448 - INFO - UMAP visualizations completed
2025-03-13 12:02:30,034 - INFO - Integration pipeline completed successfully
2025-03-13 12:02:30,034 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v2
2025-03-13 12:02:30,035 - INFO - Plotting UMAP...
