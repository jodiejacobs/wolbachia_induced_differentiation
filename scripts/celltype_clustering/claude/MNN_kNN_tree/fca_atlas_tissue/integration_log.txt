2025-03-13 15:08:57,629 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 15:08:57,629 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 15:08:57,629 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/fca_adata.h5ad
2025-03-13 15:08:57,629 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/fca_atlas_tissue
2025-03-13 15:08:57,629 - INFO - Loading data files...
2025-03-13 15:08:57,770 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 15:10:55,883 - INFO - Reference dataset loaded: (62515, 2431) (cells × genes)
2025-03-13 15:10:55,904 - INFO - Number of shared genes: 1234
2025-03-13 15:10:55,904 - INFO - Preprocessing datasets...
2025-03-13 15:12:26,712 - INFO - Using 1234 shared genes
2025-03-13 15:40:46,700 - INFO - Integrating datasets...
2025-03-13 15:40:47,056 - INFO - Combined dataset shape: (6688, 1234)
2025-03-13 15:40:47,057 - INFO - Data is already normalized and log-transformed
2025-03-13 15:40:47,173 - INFO - Applying BBKNN batch correction...
2025-03-13 15:41:55,760 - INFO - Automatically determined k = 39 (sqrt(n) = 81, 10% of smallest class = 39)
2025-03-13 15:41:55,785 - INFO - Performing kNN classification with k=39...
2025-03-13 15:41:55,789 - INFO - Sample values from 'tissue': ['testis', 'testis', 'testis', 'testis', 'testis']
2025-03-13 15:41:55,841 - INFO - Successfully extracted 6664 reference labels
2025-03-13 15:41:55,842 - INFO - Reference cells: 6664, Bulk samples: 24
2025-03-13 15:41:55,842 - INFO - Using UMAP embeddings for kNN search
2025-03-13 15:41:55,842 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 15:41:56,408 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 15:41:56,778 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 15:41:57,141 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 15:41:57,507 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 15:41:57,872 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 15:41:58,243 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 15:41:58,673 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 15:41:59,098 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 15:41:59,523 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 15:41:59,956 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 15:42:00,415 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 15:42:00,848 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 15:42:01,310 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 15:42:01,768 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 15:42:02,203 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 15:42:02,661 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 15:42:03,093 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 15:42:03,554 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 15:42:03,985 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 15:42:04,414 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 15:42:04,841 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 15:42:05,271 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 15:42:05,703 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 15:42:06,135 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 15:42:06,135 - INFO - Classification summary:
2025-03-13 15:42:06,137 - INFO -   head: 12 bulk samples (mean confidence: 0.8599)
2025-03-13 15:42:06,138 - INFO -   malpighian_tubule: 6 bulk samples (mean confidence: 1.0000)
2025-03-13 15:42:06,139 - INFO -   male_reproductive_glands: 4 bulk samples (mean confidence: 0.5366)
2025-03-13 15:42:06,139 - INFO -   testis: 2 bulk samples (mean confidence: 0.5296)
2025-03-13 15:42:06,139 - INFO - P-value summary:
2025-03-13 15:42:06,140 - INFO -   Mean p-value: 0.5505
2025-03-13 15:42:06,140 - INFO -   Median p-value: 0.4865
2025-03-13 15:42:06,141 - INFO -   Min p-value: 0.0080
2025-03-13 15:42:06,141 - INFO -   Max p-value: 1.0000
2025-03-13 15:42:06,141 - INFO - Generating UMAP visualizations...
2025-03-13 15:42:44,671 - INFO - UMAP visualizations completed
2025-03-13 15:42:45,420 - INFO - Integration pipeline completed successfully
2025-03-13 15:42:45,420 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/fca_atlas_tissue
2025-03-13 15:42:45,420 - INFO - Plotting UMAP...
2025-03-13 15:55:22,988 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 15:55:23,099 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 15:55:23,099 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/fca_adata.h5ad
2025-03-13 15:55:23,099 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/fca_atlas_tissue
2025-03-13 15:55:23,100 - INFO - Loading data files...
2025-03-13 15:55:23,334 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 16:00:32,708 - INFO - Reference dataset loaded: (62515, 2431) (cells × genes)
2025-03-13 16:00:32,885 - INFO - Number of shared genes: 1234
2025-03-13 16:00:32,885 - INFO - Preprocessing datasets...
2025-03-13 16:02:30,970 - INFO - Using 1234 shared genes
2025-03-13 16:32:09,896 - INFO - Integrating datasets...
2025-03-13 16:32:10,112 - INFO - Combined dataset shape: (6688, 1234)
2025-03-13 16:32:10,112 - INFO - Data is already normalized and log-transformed
2025-03-13 16:32:10,221 - INFO - Applying BBKNN batch correction...
2025-03-13 16:33:23,565 - INFO - Automatically determined k = 39 (sqrt(n) = 81, 10% of smallest class = 39)
2025-03-13 16:33:23,598 - INFO - Performing kNN classification with k=39...
2025-03-13 16:33:23,603 - INFO - Sample values from 'tissue': ['testis', 'testis', 'testis', 'testis', 'testis']
2025-03-13 16:33:23,657 - INFO - Successfully extracted 6664 reference labels
2025-03-13 16:33:23,658 - INFO - Reference cells: 6664, Bulk samples: 24
2025-03-13 16:33:23,658 - INFO - Using UMAP embeddings for kNN search
2025-03-13 16:33:23,658 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 16:33:24,293 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 16:33:24,707 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 16:33:25,121 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 16:33:25,530 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 16:33:25,943 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 16:33:26,360 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 16:33:26,840 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 16:33:27,318 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 16:33:27,794 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 16:33:28,275 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 16:33:28,751 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 16:33:29,239 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 16:33:29,732 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 16:33:30,259 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 16:33:30,791 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 16:33:31,303 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 16:33:31,781 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 16:33:32,293 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 16:33:32,759 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 16:33:33,245 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 16:33:33,743 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 16:33:34,264 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 16:33:34,770 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 16:33:35,400 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 16:33:35,400 - INFO - Classification summary:
2025-03-13 16:33:35,403 - INFO -   head: 12 bulk samples (mean confidence: 0.8599)
2025-03-13 16:33:35,404 - INFO -   malpighian_tubule: 6 bulk samples (mean confidence: 1.0000)
2025-03-13 16:33:35,404 - INFO -   male_reproductive_glands: 4 bulk samples (mean confidence: 0.5366)
2025-03-13 16:33:35,405 - INFO -   testis: 2 bulk samples (mean confidence: 0.5296)
2025-03-13 16:33:35,405 - INFO - P-value summary:
2025-03-13 16:33:35,406 - INFO -   Mean p-value: 0.5505
2025-03-13 16:33:35,407 - INFO -   Median p-value: 0.4865
2025-03-13 16:33:35,407 - INFO -   Min p-value: 0.0080
2025-03-13 16:33:35,408 - INFO -   Max p-value: 1.0000
2025-03-13 16:33:35,408 - INFO - Generating UMAP visualizations...
2025-03-13 16:34:16,498 - INFO - UMAP visualizations completed
2025-03-13 16:34:17,117 - INFO - Integration pipeline completed successfully
2025-03-13 16:34:17,117 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/fca_atlas_tissue
2025-03-13 16:34:17,117 - INFO - Plotting UMAP...
