2025-03-13 12:33:57,367 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 12:33:57,367 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 12:33:57,368 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 12:33:57,368 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:33:57,368 - INFO - Loading data files...
2025-03-13 12:33:57,504 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 12:33:57,919 - INFO - Reference dataset info: (14399, 2000) (cells × genes)
2025-03-13 12:33:57,920 - INFO - Available columns in reference dataset: ['orig.ident', 'nCount_RNA', 'nFeature_RNA', 'dataset', 'Library', 'percent.mt', 'celltype', 'subclustering', 'origin', 'condition', 'celltype_condition', 'celltype_condition_timepoint', 'n_genes', 'leiden']
2025-03-13 12:33:57,921 - INFO - Number of shared genes: 1024
2025-03-13 12:33:57,921 - INFO - Loading reference data with shared genes directly to memory...
2025-03-13 12:34:00,119 - INFO - Reference dataset loaded with shared genes: (14399, 1024)
2025-03-13 12:34:00,423 - INFO - Preprocessing datasets...
2025-03-13 12:34:01,035 - INFO - Using 1024 shared genes
2025-03-13 12:34:04,285 - INFO - Concatenating 5 subsampled datasets
2025-03-13 12:34:04,535 - INFO - Integrating datasets...
2025-03-13 12:34:04,536 - INFO - Concatenating datasets...
2025-03-13 12:34:04,559 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 12:34:04,729 - INFO - Data is already normalized and log-transformed
2025-03-13 12:34:04,730 - INFO - Checking for and handling NaN values...
2025-03-13 12:34:04,742 - INFO - Applying BBKNN batch correction...
2025-03-13 12:34:04,742 - INFO - Computing PCA...
2025-03-13 12:34:07,473 - INFO - Running BBKNN...
2025-03-13 12:34:11,940 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 12:34:11,940 - INFO - Performing kNN classification with k=21...
2025-03-13 12:34:11,941 - ERROR - Annotation key 'subclustering' not found in combined data
2025-03-13 12:34:11,941 - ERROR - Available columns: ['dataset', 'n_genes', 'leiden']
2025-03-13 12:34:11,941 - WARNING - Using 'dataset' as fallback annotation key
2025-03-13 12:34:11,942 - INFO - Sample values from 'dataset': ['reference', 'reference', 'reference', 'reference', 'reference']
2025-03-13 12:34:11,944 - INFO - Successfully extracted 1070 reference labels
2025-03-13 12:34:11,945 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:34:11,945 - INFO - Using UMAP embeddings for kNN search
2025-03-13 12:34:11,945 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 12:34:12,210 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 12:34:12,465 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 12:34:12,719 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 12:34:12,971 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 12:34:13,252 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 12:34:13,505 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 12:34:13,757 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 12:34:14,011 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 12:34:14,270 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 12:34:14,534 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 12:34:14,788 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 12:34:15,041 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 12:34:15,293 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 12:34:15,549 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 12:34:15,801 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 12:34:16,063 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 12:34:16,320 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 12:34:16,580 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 12:34:16,840 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 12:34:17,095 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 12:34:17,349 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 12:34:17,603 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 12:34:17,857 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 12:34:18,118 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 12:34:18,118 - INFO - Classification summary:
2025-03-13 12:34:18,120 - INFO -   reference: 24 bulk samples (mean confidence: 1.0000)
2025-03-13 12:34:18,120 - INFO - P-value summary:
2025-03-13 12:34:18,120 - INFO -   Mean p-value: 1.0000
2025-03-13 12:34:18,121 - INFO -   Median p-value: 1.0000
2025-03-13 12:34:18,121 - INFO -   Min p-value: 1.0000
2025-03-13 12:34:18,121 - INFO -   Max p-value: 1.0000
2025-03-13 12:34:18,121 - INFO - Generating UMAP visualizations...
2025-03-13 12:34:18,131 - INFO - Generating dataset plot...
2025-03-13 12:34:18,937 - INFO - Generating subclustering plot...
2025-03-13 12:42:19,678 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 12:42:19,699 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 12:42:19,699 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 12:42:19,699 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:42:19,699 - INFO - Loading data files...
2025-03-13 12:42:19,837 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 12:42:21,141 - INFO - Reference dataset loaded: (14399, 2000) (cells × genes)
2025-03-13 12:42:21,146 - INFO - Number of shared genes: 1024
2025-03-13 12:42:21,146 - INFO - Preprocessing datasets...
2025-03-13 12:42:21,945 - INFO - Using 1024 shared genes
2025-03-13 12:42:25,022 - INFO - Integrating datasets...
2025-03-13 12:42:25,051 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 12:42:25,052 - INFO - Data is already normalized and log-transformed
2025-03-13 12:42:25,069 - INFO - Applying BBKNN batch correction...
2025-03-13 12:42:29,389 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 12:42:29,389 - INFO - Performing kNN classification with k=21...
2025-03-13 12:42:29,390 - INFO - Sample values from 'subclustering': ['PH', 'PH', 'PH', 'PH', 'PH']
2025-03-13 12:42:29,397 - INFO - Successfully extracted 1070 reference labels
2025-03-13 12:42:29,397 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:42:29,397 - INFO - Using UMAP embeddings for kNN search
2025-03-13 12:42:29,397 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 12:42:29,827 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 12:42:30,240 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 12:42:30,650 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 12:42:31,068 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 12:42:31,502 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 12:42:31,965 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 12:42:32,379 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 12:42:32,791 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 12:42:33,200 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 12:42:33,606 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 12:42:34,011 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 12:42:34,420 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 12:42:34,833 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 12:42:35,249 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 12:42:35,632 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 12:42:36,047 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 12:42:36,429 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 12:42:36,810 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 12:42:37,223 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 12:42:37,635 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 12:42:38,049 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 12:42:38,432 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 12:42:38,814 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 12:42:39,227 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 12:42:39,227 - INFO - Classification summary:
2025-03-13 12:42:39,229 - INFO -   LM: 12 bulk samples (mean confidence: 0.7944)
2025-03-13 12:42:39,230 - INFO -   PM: 12 bulk samples (mean confidence: 0.5840)
2025-03-13 12:42:39,230 - INFO - P-value summary:
2025-03-13 12:42:39,230 - INFO -   Mean p-value: 0.3596
2025-03-13 12:42:39,231 - INFO -   Median p-value: 0.3795
2025-03-13 12:42:39,231 - INFO -   Min p-value: 0.0960
2025-03-13 12:42:39,231 - INFO -   Max p-value: 0.6480
2025-03-13 12:42:39,232 - INFO - Generating UMAP visualizations...
2025-03-13 12:42:53,575 - INFO - UMAP visualizations completed
2025-03-13 12:42:53,801 - INFO - Integration pipeline completed successfully
2025-03-13 12:42:53,802 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:42:53,802 - INFO - Plotting UMAP...
2025-03-13 12:47:05,123 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 12:47:05,270 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 12:47:05,270 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 12:47:05,271 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:47:05,271 - INFO - Loading data files...
2025-03-13 12:47:05,441 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 12:47:06,730 - INFO - Reference dataset loaded: (14399, 2000) (cells × genes)
2025-03-13 12:47:06,734 - INFO - Number of shared genes: 1024
2025-03-13 12:47:06,734 - INFO - Preprocessing datasets...
2025-03-13 12:47:07,458 - INFO - Using 1024 shared genes
2025-03-13 12:47:10,494 - INFO - Integrating datasets...
2025-03-13 12:47:10,523 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 12:47:10,524 - INFO - Data is already normalized and log-transformed
2025-03-13 12:47:10,546 - INFO - Applying BBKNN batch correction...
2025-03-13 12:47:14,820 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 12:47:14,820 - INFO - Performing kNN classification with k=21...
2025-03-13 12:47:14,821 - INFO - Sample values from 'subclustering': ['PH', 'PH', 'PH', 'PH', 'PH']
2025-03-13 12:47:14,828 - INFO - Successfully extracted 1070 reference labels
2025-03-13 12:47:14,828 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:47:14,828 - INFO - Using UMAP embeddings for kNN search
2025-03-13 12:47:14,828 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 12:47:15,268 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 12:47:15,687 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 12:47:16,107 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 12:47:16,544 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 12:47:16,967 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 12:47:17,451 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 12:47:17,872 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 12:47:18,293 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 12:47:18,711 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 12:47:19,133 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 12:47:19,593 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 12:47:20,021 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 12:47:20,446 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 12:47:20,865 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 12:47:21,262 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 12:47:21,681 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 12:47:22,072 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 12:47:22,458 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 12:47:22,879 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 12:47:23,294 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 12:47:23,710 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 12:47:24,095 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 12:47:24,487 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 12:47:24,909 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 12:47:24,909 - INFO - Classification summary:
2025-03-13 12:47:24,911 - INFO -   LM: 12 bulk samples (mean confidence: 0.7944)
2025-03-13 12:47:24,912 - INFO -   PM: 12 bulk samples (mean confidence: 0.5840)
2025-03-13 12:47:24,912 - INFO - P-value summary:
2025-03-13 12:47:24,912 - INFO -   Mean p-value: 0.3596
2025-03-13 12:47:24,913 - INFO -   Median p-value: 0.3795
2025-03-13 12:47:24,913 - INFO -   Min p-value: 0.0960
2025-03-13 12:47:24,914 - INFO -   Max p-value: 0.6480
2025-03-13 12:47:24,914 - INFO - Generating UMAP visualizations...
2025-03-13 12:47:39,277 - INFO - UMAP visualizations completed
2025-03-13 12:47:39,482 - INFO - Integration pipeline completed successfully
2025-03-13 12:47:39,482 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:47:39,483 - INFO - Plotting UMAP...
2025-03-13 12:48:18,322 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 12:48:18,347 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 12:48:18,347 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 12:48:18,347 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:48:18,347 - INFO - Loading data files...
2025-03-13 12:48:18,486 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 12:48:19,591 - INFO - Reference dataset loaded: (14399, 2000) (cells × genes)
2025-03-13 12:48:19,594 - INFO - Number of shared genes: 1024
2025-03-13 12:48:19,594 - INFO - Preprocessing datasets...
2025-03-13 12:48:20,331 - INFO - Using 1024 shared genes
2025-03-13 12:48:23,398 - INFO - Integrating datasets...
2025-03-13 12:48:23,428 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 12:48:23,428 - INFO - Data is already normalized and log-transformed
2025-03-13 12:48:23,449 - INFO - Applying BBKNN batch correction...
2025-03-13 12:48:27,694 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 12:48:27,694 - INFO - Performing kNN classification with k=21...
2025-03-13 12:48:27,695 - INFO - Sample values from 'subclustering': ['PH', 'PH', 'PH', 'PH', 'PH']
2025-03-13 12:48:27,702 - INFO - Successfully extracted 1070 reference labels
2025-03-13 12:48:27,702 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:48:27,702 - INFO - Using UMAP embeddings for kNN search
2025-03-13 12:48:27,702 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 12:48:28,130 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 12:48:28,538 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 12:48:28,947 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 12:48:29,384 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 12:48:29,789 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 12:48:30,255 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 12:48:30,664 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 12:48:31,077 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 12:48:31,483 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 12:48:31,893 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 12:48:32,300 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 12:48:32,732 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 12:48:33,146 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 12:48:33,569 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 12:48:33,950 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 12:48:34,360 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 12:48:34,740 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 12:48:35,126 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 12:48:35,537 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 12:48:35,948 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 12:48:36,355 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 12:48:36,732 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 12:48:37,114 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 12:48:37,521 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 12:48:37,521 - INFO - Classification summary:
2025-03-13 12:48:37,523 - INFO -   LM: 12 bulk samples (mean confidence: 0.7944)
2025-03-13 12:48:37,523 - INFO -   PM: 12 bulk samples (mean confidence: 0.5840)
2025-03-13 12:48:37,524 - INFO - P-value summary:
2025-03-13 12:48:37,524 - INFO -   Mean p-value: 0.3596
2025-03-13 12:48:37,525 - INFO -   Median p-value: 0.3795
2025-03-13 12:48:37,525 - INFO -   Min p-value: 0.0960
2025-03-13 12:48:37,525 - INFO -   Max p-value: 0.6480
2025-03-13 12:48:37,525 - INFO - Generating UMAP visualizations...
2025-03-13 12:48:51,281 - INFO - UMAP visualizations completed
2025-03-13 12:48:51,925 - INFO - Integration pipeline completed successfully
2025-03-13 12:48:51,925 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:48:51,926 - INFO - Plotting UMAP...
2025-03-13 12:49:43,417 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 12:49:43,423 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 12:49:43,423 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 12:49:43,423 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:49:43,423 - INFO - Loading data files...
2025-03-13 12:49:43,562 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 12:49:44,832 - INFO - Reference dataset loaded: (14399, 2000) (cells × genes)
2025-03-13 12:49:44,836 - INFO - Number of shared genes: 1024
2025-03-13 12:49:44,836 - INFO - Preprocessing datasets...
2025-03-13 12:49:45,563 - INFO - Using 1024 shared genes
2025-03-13 12:49:48,668 - INFO - Integrating datasets...
2025-03-13 12:49:48,697 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 12:49:48,698 - INFO - Data is already normalized and log-transformed
2025-03-13 12:49:48,718 - INFO - Applying BBKNN batch correction...
2025-03-13 12:49:53,064 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 12:49:53,064 - INFO - Performing kNN classification with k=21...
2025-03-13 12:49:53,065 - INFO - Sample values from 'subclustering': ['PH', 'PH', 'PH', 'PH', 'PH']
2025-03-13 12:49:53,072 - INFO - Successfully extracted 1070 reference labels
2025-03-13 12:49:53,072 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:49:53,072 - INFO - Using UMAP embeddings for kNN search
2025-03-13 12:49:53,072 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 12:49:53,502 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 12:49:53,914 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 12:49:54,322 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 12:49:54,734 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 12:49:55,153 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 12:49:55,621 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 12:49:56,035 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 12:49:56,445 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 12:49:56,853 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 12:49:57,268 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 12:49:57,681 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 12:49:58,098 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 12:49:58,506 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 12:49:58,917 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 12:49:59,299 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 12:49:59,712 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 12:50:00,106 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 12:50:00,489 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 12:50:00,911 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 12:50:01,350 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 12:50:01,759 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 12:50:02,146 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 12:50:02,528 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 12:50:02,941 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 12:50:02,941 - INFO - Classification summary:
2025-03-13 12:50:02,943 - INFO -   LM: 12 bulk samples (mean confidence: 0.7944)
2025-03-13 12:50:02,944 - INFO -   PM: 12 bulk samples (mean confidence: 0.5840)
2025-03-13 12:50:02,944 - INFO - P-value summary:
2025-03-13 12:50:02,944 - INFO -   Mean p-value: 0.3596
2025-03-13 12:50:02,945 - INFO -   Median p-value: 0.3795
2025-03-13 12:50:02,945 - INFO -   Min p-value: 0.0960
2025-03-13 12:50:02,945 - INFO -   Max p-value: 0.6480
2025-03-13 12:50:02,946 - INFO - Generating UMAP visualizations...
2025-03-13 12:50:17,671 - INFO - UMAP visualizations completed
2025-03-13 12:50:17,893 - INFO - Integration pipeline completed successfully
2025-03-13 12:50:17,893 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:50:17,893 - INFO - Plotting UMAP...
2025-03-13 12:51:10,498 - INFO - Starting Scanpy bulk to single-cell integration pipeline
2025-03-13 12:51:10,499 - INFO - Bulk data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/bulk_adata.h5ad
2025-03-13 12:51:10,500 - INFO - Reference data: /private/groups/russelllab/jodie/wolbachia_induced_DE/scanpy_clustering/scanpy_objects/blood_adata.h5ad
2025-03-13 12:51:10,500 - INFO - Output directory: /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:51:10,500 - INFO - Loading data files...
2025-03-13 12:51:10,666 - INFO - Bulk dataset loaded: (24, 10957) (samples × genes)
2025-03-13 12:51:11,734 - INFO - Reference dataset loaded: (14399, 2000) (cells × genes)
2025-03-13 12:51:11,738 - INFO - Number of shared genes: 1024
2025-03-13 12:51:11,738 - INFO - Preprocessing datasets...
2025-03-13 12:51:12,447 - INFO - Using 1024 shared genes
2025-03-13 12:51:15,432 - INFO - Integrating datasets...
2025-03-13 12:51:15,462 - INFO - Combined dataset shape: (1094, 1024)
2025-03-13 12:51:15,462 - INFO - Data is already normalized and log-transformed
2025-03-13 12:51:15,482 - INFO - Applying BBKNN batch correction...
2025-03-13 12:51:19,634 - INFO - Automatically determined k = 21 (sqrt(n) = 32, 10% of smallest class = 21)
2025-03-13 12:51:19,635 - INFO - Performing kNN classification with k=21...
2025-03-13 12:51:19,636 - INFO - Sample values from 'subclustering': ['PH', 'PH', 'PH', 'PH', 'PH']
2025-03-13 12:51:19,642 - INFO - Successfully extracted 1070 reference labels
2025-03-13 12:51:19,642 - INFO - Reference cells: 1070, Bulk samples: 24
2025-03-13 12:51:19,642 - INFO - Using UMAP embeddings for kNN search
2025-03-13 12:51:19,642 - INFO - Processing bulk sample 1/24: JW18DOX221117-1
2025-03-13 12:51:20,072 - INFO - Processing bulk sample 2/24: JW18DOX221117-2
2025-03-13 12:51:20,475 - INFO - Processing bulk sample 3/24: JW18DOX221117-3
2025-03-13 12:51:20,872 - INFO - Processing bulk sample 4/24: JW18DOX221117-4
2025-03-13 12:51:21,275 - INFO - Processing bulk sample 5/24: JW18DOX221117-5
2025-03-13 12:51:21,672 - INFO - Processing bulk sample 6/24: JW18DOX221117-6
2025-03-13 12:51:22,167 - INFO - Processing bulk sample 7/24: JW18wMel221117-1
2025-03-13 12:51:22,566 - INFO - Processing bulk sample 8/24: JW18wMel221117-2
2025-03-13 12:51:22,965 - INFO - Processing bulk sample 9/24: JW18wMel221117-3
2025-03-13 12:51:23,365 - INFO - Processing bulk sample 10/24: JW18wMel221117-4
2025-03-13 12:51:23,763 - INFO - Processing bulk sample 11/24: JW18wMel221117-5
2025-03-13 12:51:24,165 - INFO - Processing bulk sample 12/24: JW18wMel221117-6
2025-03-13 12:51:24,565 - INFO - Processing bulk sample 13/24: S2DOX221117-1
2025-03-13 12:51:24,963 - INFO - Processing bulk sample 14/24: S2DOX221117-2
2025-03-13 12:51:25,373 - INFO - Processing bulk sample 15/24: S2DOX221117-3
2025-03-13 12:51:25,741 - INFO - Processing bulk sample 16/24: S2DOX221117-4
2025-03-13 12:51:26,144 - INFO - Processing bulk sample 17/24: S2DOX221117-5
2025-03-13 12:51:26,516 - INFO - Processing bulk sample 18/24: S2DOX221117-6
2025-03-13 12:51:26,884 - INFO - Processing bulk sample 19/24: S2wMel221117-1
2025-03-13 12:51:27,285 - INFO - Processing bulk sample 20/24: S2wMel221117-2
2025-03-13 12:51:27,686 - INFO - Processing bulk sample 21/24: S2wMel221117-3
2025-03-13 12:51:28,090 - INFO - Processing bulk sample 22/24: S2wMel221117-4
2025-03-13 12:51:28,458 - INFO - Processing bulk sample 23/24: S2wMel221117-5
2025-03-13 12:51:28,827 - INFO - Processing bulk sample 24/24: S2wMel221117-6
2025-03-13 12:51:29,230 - INFO - kNN classification completed for all 24 bulk samples
2025-03-13 12:51:29,230 - INFO - Classification summary:
2025-03-13 12:51:29,232 - INFO -   LM: 12 bulk samples (mean confidence: 0.7944)
2025-03-13 12:51:29,233 - INFO -   PM: 12 bulk samples (mean confidence: 0.5840)
2025-03-13 12:51:29,233 - INFO - P-value summary:
2025-03-13 12:51:29,234 - INFO -   Mean p-value: 0.3596
2025-03-13 12:51:29,234 - INFO -   Median p-value: 0.3795
2025-03-13 12:51:29,234 - INFO -   Min p-value: 0.0960
2025-03-13 12:51:29,235 - INFO -   Max p-value: 0.6480
2025-03-13 12:51:29,235 - INFO - Generating UMAP visualizations...
2025-03-13 12:51:43,619 - INFO - UMAP visualizations completed
2025-03-13 12:51:43,798 - INFO - Integration pipeline completed successfully
2025-03-13 12:51:43,798 - INFO - Results saved to /private/groups/russelllab/jodie/wolbachia_induced_DE/wolbachia_induced_differentiation/scripts/celltype_clustering/claude/MNN_kNN_tree/blood_atlas_v4
2025-03-13 12:51:43,798 - INFO - Plotting UMAP...
